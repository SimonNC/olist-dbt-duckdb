version: 2

models:
  - name: int_payments__order_level
    description: "Payments aggregated at order level. Grain: one row per order_id."
    columns:
      - name: order_id
        tests:
          - not_null
          - unique
          - relationships:
              arguments:
                to: ref('stg_olist__orders')
                field: order_id

      - name: payment_value_total
        tests: [not_null]

      - name: payment_installments_max
        tests: [not_null]

      - name: payment_type_primary
        tests: [not_null]

  - name: int_order_items__order_level
    description: "Order items aggregated at order level."
    columns:
      - name: order_id
        tests:
          - not_null
          - unique
          - relationships:
              arguments:
                to: ref('stg_olist__orders')
                field: order_id

      - name: items_count
        tests: [not_null]

      - name: items_gmv
        tests: [not_null]

      - name: freight_total
        tests: [not_null]
  - name: int_customers__order_metrics
    description: "Customer-level metrics aggregated from fct_orders."
    columns:
      - name: customer_id
        tests:
          - not_null
          - unique
          - relationships:
              arguments:
                to: ref('stg_olist__customers')
                field: customer_id
      - name: orders_count
        tests: [not_null]
      - name: first_order_ts
      - name: last_order_ts
      - name: revenue_total
        tests: [not_null]
  - name: int_customers_unique__order_metrics
    description: "Real-customer metrics (customer_unique_id) aggregated from fct_orders using dim_customer_ids bridge."
    columns:
      - name: customer_unique_id
        tests: [not_null, unique]
      - name: orders_count
        tests: [not_null]
      - name: revenue_total
        tests: [not_null]

