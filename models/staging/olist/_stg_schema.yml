version: 2

models:
  - name: stg_olist__orders
    description: "Orders from Olist, cleaned and typed. Grain: one row per order."
    columns:
      - name: order_id
        tests: [not_null, unique]

      - name: customer_id
        tests: [not_null]

      - name: order_status
        tests:
          - not_null
          - accepted_values:
              arguments:
                values:
                  - delivered
                  - shipped
                  - canceled
                  - unavailable
                  - processing
                  - created
                  - approved
                  - invoiced

  - name: stg_olist__order_items
    description: "Order items from Olist. Grain: one row per (order_id, order_item_id)."
    columns:
      - name: order_id
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('stg_olist__orders')
                field: order_id

      - name: order_item_id
        tests: [not_null]

      - name: product_id
        tests: [not_null]

      - name: seller_id
        tests: [not_null]

  - name: stg_olist__payments
    description: "Payments from Olist, typed. Grain: one row per payment event (order_id, payment_sequential)."
    columns:
      - name: order_id
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('stg_olist__orders')
                field: order_id

      - name: payment_sequential
        tests: [not_null]

      - name: payment_type
        tests:
          - not_null
          - accepted_values:
              arguments:
                values:
                  - credit_card
                  - boleto
                  - voucher
                  - debit_card
                  - not_defined

      - name: payment_value
        tests: [not_null]

  - name: stg_olist__customers
    description: "Customers from Olist, typed."
    columns:
      - name: customer_id
        tests: [not_null, unique]

      - name: customer_unique_id
        tests: [not_null]

      - name: customer_zip_code_prefix
        tests: [not_null]

      - name: customer_state
        tests: [not_null]

  - name: stg_olist__sellers
    description: "Sellers from Olist, typed."
    columns:
      - name: seller_id
        tests: [not_null, unique]

      - name: seller_zip_code_prefix
        tests: [not_null]

      - name: seller_state
        tests: [not_null]
