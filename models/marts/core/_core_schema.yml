version: 2

models:
  - name: fct_orders
    description: "Core fact table at order grain combining orders, items, and payments."
    columns:
      - name: order_id
        tests: [not_null, unique]

      - name: customer_id
        tests: [not_null]

      - name: order_status
        tests: [not_null]

      - name: items_count
        tests: [not_null]

      - name: items_gmv
        tests: [not_null]

      - name: freight_total
        tests: [not_null]

      - name: payment_value_total
        tests: [not_null]

  - name: dim_customers
    description: "Customer dimension at customer_id grain enriched with order behavior metrics."
    columns:
      - name: customer_id
        tests: [not_null, unique]

      - name: customer_unique_id
        tests: [not_null]

      - name: customer_state
        tests: [not_null]

      - name: orders_count
        tests: [not_null]

      - name: revenue_total
        tests: [not_null]

      - name: customer_segment
        tests:
          - not_null
          - accepted_values:
              arguments:
                values:
                  - no_orders
                  - one_time
                  - repeat

  - name: dim_customer_ids
    description: "Bridge table mapping technical customer_id to real customer_unique_id."
    columns:
      - name: customer_id
        tests: [not_null, unique]

      - name: customer_unique_id
        tests: [not_null]

  - name: dim_customers_unique
    description: "Real customer dimension at customer_unique_id grain with aggregated behavior and primary geo profile."
    columns:
      - name: customer_unique_id
        tests: [not_null, unique]

      - name: orders_count
        tests: [not_null]

      - name: revenue_total
        tests: [not_null]

      - name: customer_segment
        tests:
          - not_null
          - accepted_values:
              arguments:
                values:
                  - no_orders
                  - one_time
                  - repeat
