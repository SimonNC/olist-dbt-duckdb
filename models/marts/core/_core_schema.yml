version: 2

models:
  - name: fct_orders
    description: |
      Canonical **order fact table**.
      **Grain:** one row per `order_id`.

      This model combines orders, items, and payments into a single
      analytics-ready fact table. It acts as the **single source of truth**
      for all order-level metrics and feeds downstream KPI marts.

    meta:
      owner: "Simon"
      domain: "orders"
      maturity: "stable"

    columns:
      - name: order_id
        description: "Unique identifier of an order. Defines the grain of the fact table."
        tests: [not_null, unique]

      - name: customer_id
        description: "Technical customer identifier used for joins with customer dimensions."
        tests: [not_null]

      - name: order_status
        description: "Current lifecycle status of the order."
        tests: [not_null]

      - name: items_count
        description: "Number of items included in the order."
        tests: [not_null]

      - name: items_gmv
        description: "Total gross merchandise value of items in the order (excluding freight)."
        tests: [not_null]

      - name: freight_total
        description: "Total freight amount charged for the order."
        tests: [not_null]

      - name: payment_value_total
        description: "Total amount paid for the order, computed as the sum of all payment events."
        tests: [not_null]

  - name: dim_customers
    description: |
      Customer dimension at **technical grain** (`customer_id`).

      This table enriches customers with aggregated order behavior metrics
      and is primarily used for operational and order-level analysis.

    meta:
      owner: "Simon"
      domain: "customers"
      maturity: "stable"

    columns:
      - name: customer_id
        description: "Technical identifier of a customer."
        tests: [not_null, unique]

      - name: customer_unique_id
        description: "Business-level customer identifier shared across multiple orders."
        tests: [not_null]

      - name: customer_state
        description: "State associated with the customer's primary delivery address."
        tests: [not_null]

      - name: orders_count
        description: "Total number of orders placed by the customer."
        tests: [not_null]

      - name: revenue_total
        description: "Total revenue generated by the customer across all orders."
        tests: [not_null]

      - name: customer_segment
        description: |
          Customer segmentation based on order history:
          - no_orders
          - one_time
          - repeat
        tests:
          - not_null
          - accepted_values:
              arguments:
                values:
                  - no_orders
                  - one_time
                  - repeat

  - name: dim_customer_ids
    description: |
      Bridge table mapping **technical customer identifiers** to
      **business-level customer identifiers**.

      This table enables analysis at the real customer level
      (`customer_unique_id`) while preserving joins with operational data.

    meta:
      owner: "Simon"
      domain: "customers"
      maturity: "stable"

    columns:
      - name: customer_id
        description: "Technical customer identifier."
        tests: [not_null, unique]

      - name: customer_unique_id
        description: "Business-level customer identifier."
        tests: [not_null]

  - name: dim_customers_unique
    description: |
      Customer dimension at **business grain** (`customer_unique_id`).

      Aggregates customer behavior across all associated technical customer IDs.
      Used for **retention, repeat customer, and lifetime value analysis**.

    meta:
      owner: "Simon"
      domain: "customers"
      maturity: "stable"

    columns:
      - name: customer_unique_id
        description: "Business-level unique identifier of a customer."
        tests: [not_null, unique]

      - name: orders_count
        description: "Total number of orders placed by the customer."
        tests: [not_null]

      - name: revenue_total
        description: "Total revenue generated by the customer across all orders."
        tests: [not_null]

      - name: customer_segment
        description: |
          Customer segmentation based on lifetime order behavior:
          - no_orders
          - one_time
          - repeat
        tests:
          - not_null
          - accepted_values:
              arguments:
                values:
                  - no_orders
                  - one_time
                  - repeat
